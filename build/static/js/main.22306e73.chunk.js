(this.webpackJsonpcad=this.webpackJsonpcad||[]).push([[0],{52:function(e,t,a){e.exports=a(76)},57:function(e,t,a){},58:function(e,t,a){},68:function(e,t,a){},76:function(e,t,a){"use strict";a.r(t);var s=a(1),n=a.n(s),r=a(48),i=a.n(r),c=(a(57),a(24)),o=a(16),l=a(3),h=a(2),u=a(8),p=a(6),f=a(11),d=a(9),m={TX:"x",TY:"y",TZ:"z"},b=(a(58),a(59)),v=Math.PI/180,g=[[1,0,0,0],[0,1,0,0],[0,0,1,0],[0,0,0,1]],k=function(e){return JSON.parse(JSON.stringify(e))},y=function(e){return k([e[0]/e[3],e[1]/e[3],e[2]/e[3],e[3]/e[3]])},E=function(){function e(){Object(l.a)(this,e),this.g={0:function(e){return(1-e)*(1-e)},1:function(e){return 2*e*(1-e)*(1-e)},2:function(e){return 2*(1-e)*e*e},3:function(e){return e*e}},this.transformSteck=[k(g)],this.transformMatrix=k(g),this.basePoints=[],this.lines=[],this.splines=[],this.surfaces=[],this.backupPoints=[],this.sweep={apply:!1,scale:1,centerRegion:{x:0,y:0}}}return Object(h.a)(e,[{key:"addTransferMatrix",value:function(e,t){var a=k(g);switch(t){case m.TX:a[3][0]=e;break;case m.TY:a[3][1]=e;break;case m.TZ:a[3][2]=e;break;default:throw Error("Unexpected token ".concat(t))}this.transformSteck.push(a)}},{key:"addScaleMatrix",value:function(e,t){var a=k(g);switch(t){case m.TX:a[0][0]=e;break;case m.TY:a[1][1]=e;break;case m.TZ:a[2][2]=e;break;default:throw Error("Unexpected token ".concat(t))}this.transformSteck.push(a)}},{key:"addRotateMatrix",value:function(e,t){var a=e*v;switch(t){case m.TX:this.transformSteck.push([[1,0,0,0],[0,Math.cos(a),Math.sin(a),0],[0,-Math.sin(a),Math.cos(a),0],[0,0,0,1]]);break;case m.TY:this.transformSteck.push([[Math.cos(a),0,-Math.sin(a),0],[0,1,0,0],[Math.sin(a),0,Math.cos(a),0],[0,0,0,1]]);break;case m.TZ:this.transformSteck.push([[Math.cos(a),Math.sin(a),0,0],[-Math.sin(a),Math.cos(a),0,0],[0,0,1,0],[0,0,0,1]]);break;default:throw Error("Unexpected token ".concat(t))}}},{key:"addShiftMatix",value:function(e){var t=k(g);t[1][0]=e,this.transformSteck.push(t)}},{key:"addFocusMatrix",value:function(e){var t=k(g);t[2][3]=0===e?0:1/e,this.transformSteck.push(t)}},{key:"setDefault",value:function(){this.transformSteck=[k(g)],this.transformMatrix=k(g),this.sweep={apply:!1,scale:1,centerRegion:{x:0,y:0}}}},{key:"setSweep",value:function(){for(var e=document.getElementById("canvas"),t=k(this.backupPoints),a=t[0][0],s=t[0][0],n=t[0][1],r=t[0][1],i=0;i<t.length;i++)t[i][0]>s&&(s=t[i][0]),t[i][0]<a&&(a=t[i][0]),t[i][1]>r&&(r=t[i][1]),t[i][1]<n&&(n=t[i][1]);var c=Math.abs(s-a),o=Math.abs(r-n),l=e.width,h=e.height,u=0;u=l>h?h-100:l-100;var p=1;p=c>o?u/c:u/o,this.sweep.apply=!0,this.sweep.scale=p,this.sweep.centerRegion={x:a+c/2,y:n+o/2},this.transformSteck.push([[p,0,0,0],[0,p,0,0],[0,0,p,0],[0,0,0,1]])}},{key:"uploadScene",value:function(e){var t=JSON.parse(e);if(!t.points)throw Error("scene invalide");this.basePoints=k(t.points),this.lines=t.lines?k(t.lines):[],this.splines=t.splines?k(t.splines):[],this.surfaces=t.surfaces?k(t.surfaces):[]}},{key:"draw",value:function(){var e=document.getElementById("canvas");if(console.log(this.transformSteck),e.getContext){var t=e.getContext("2d"),a=[];if(this.sweep.apply){t.setTransform(1,0,0,1,0,0),t.clearRect(0,0,e.width,e.height);var s=this.sweep.scale,n=this.sweep.centerRegion;t.translate(e.width/2,e.height/2),t.scale(1,-1),t.translate(-n.x*s,-n.y*s)}else t.setTransform(1,0,0,1,0,0),t.clearRect(0,0,e.width,e.height),t.translate(e.width/2,e.height/2),t.scale(1,-1);t.strokeStyle="white";for(var r=0;r<this.lines.length;r++){var i=this.lines[r],c=y(b.matrix.multiply([this.basePoints[i[0]]],this.multiplyMatrix())[0]),o=y(b.matrix.multiply([this.basePoints[i[1]]],this.multiplyMatrix())[0]);t.beginPath(),t.moveTo(c[0],c[1]),t.lineTo(o[0],o[1]),t.closePath(),t.stroke(),a.push(c),a.push(o)}for(var l=0;l<this.splines.length;l++){for(var h=[],u=this.splines[l],p=0;p<1.025;p+=.05){for(var f=[0,0,0,0],d=0;d<u.length;d++){var m=this.basePoints[u[d]],v=b.matrix.scalar([m],this.g[d](p))[0];f=b.matrix.addition(f,v)}var g=y(b.matrix.multiply([f],this.multiplyMatrix())[0]);h.push(g),a.push(g)}t.beginPath();for(var E=1;E<h.length;E++)t.moveTo(h[E-1][0],h[E-1][1]),t.lineTo(h[E][0],h[E][1]);t.closePath(),t.stroke()}for(var w=0;w<this.surfaces.length;w++){for(var T=this.surfaces[w],S=[],O=0;O<1.025;O+=.05){for(var x=[],j=0;j<1.025;j+=.05){for(var M=[0,0,0,0],C=0;C<T.length;C++)for(var R=0;R<T[C].length;R++){var B=this.basePoints[T[C][R]],F=b.matrix.scalar([B],this.g[C](O)*this.g[R](j))[0];M=b.matrix.addition(M,F)}var P=y(b.matrix.multiply([M],this.multiplyMatrix())[0]);x.push(P),a.push(P)}S.push(x)}for(var N=0;N<S.length;N++){t.beginPath();for(var Y=1;Y<S[N].length;Y++)t.moveTo(S[N][Y-1][0],S[N][Y-1][1]),t.lineTo(S[N][Y][0],S[N][Y][1]);t.closePath(),t.stroke()}for(var Z=0;Z<S.length;Z++){t.beginPath();for(var D=1;D<S[Z].length;D++)t.moveTo(S[D-1][Z][0],S[D-1][Z][1]),t.lineTo(S[D][Z][0],S[D][Z][1]);t.closePath(),t.stroke()}}this.backupPoints=k(a)}}},{key:"multiplyMatrix",value:function(){for(var e=this.transformSteck[0],t=1;t<this.transformSteck.length;t++)e=b.matrix.multiply(e,this.transformSteck[t]);return e}}]),e}(),w=(a(68),a(78),a(77),a(75),a(70),a(80),a(47),function(e){function t(){var e;return Object(l.a)(this,t),(e=Object(u.a)(this,Object(p.a)(t).call(this))).plusBtn=n.a.createRef(),e.minusBtn=n.a.createRef(),e.textField=n.a.createRef(),e}return Object(d.a)(t,e),Object(h.a)(t,[{key:"render",value:function(){return n.a.createElement("div",{className:"input-root"},n.a.createElement("ui5-label",null,this.props.label),n.a.createElement("ui5-input",{name:this.props.name,ref:this.textField}),n.a.createElement("ui5-button",{icon:"add",name:this.props.name,ref:this.plusBtn}),n.a.createElement("ui5-button",{icon:"less",name:this.props.name,ref:this.minusBtn}))}},{key:"componentDidMount",value:function(){var e=this;this.plusBtn.current.addEventListener("click",(function(t){var a=t.target.attributes.icon.value;e.props.onClick(e.props.name,a)})),this.minusBtn.current.addEventListener("click",(function(t){var a=t.target.attributes.icon.value;e.props.onClick(e.props.name,a)})),this.textField.current.addEventListener("change",(function(t){e.props.onChange(e.props.name,t.target.value)}))}}]),t}(s.Component)),T=a(94),S=a(93),O=a(95),x=(a(79),function(e){function t(){var e,a,s,r;return Object(l.a)(this,t),(r=Object(u.a)(this,Object(p.a)(t).call(this))).state={scene:new E,transfer:(e={},Object(o.a)(e,m.TX,0),Object(o.a)(e,m.TY,0),Object(o.a)(e,m.TZ,0),e),scale:(a={},Object(o.a)(a,m.TX,1),Object(o.a)(a,m.TY,1),Object(o.a)(a,m.TZ,1),a),rotate:(s={},Object(o.a)(s,m.TX,0),Object(o.a)(s,m.TY,0),Object(o.a)(s,m.TZ,0),s),shift:0,focus:0},r.uploadBtn=n.a.createRef(),r.drawBtn=n.a.createRef(),r.sweepBtn=n.a.createRef(),r.defaultBtn=n.a.createRef(),r.pressDraw=r.pressDraw.bind(Object(f.a)(r)),r.pressSweep=r.pressSweep.bind(Object(f.a)(r)),r.pressDefault=r.pressDefault.bind(Object(f.a)(r)),r.pressOpenFile=r.pressOpenFile.bind(Object(f.a)(r)),r.pressScale=r.pressScale.bind(Object(f.a)(r)),r.pressShift=r.pressShift.bind(Object(f.a)(r)),r.pressFocus=r.pressFocus.bind(Object(f.a)(r)),r.pressTransfer=r.pressTransfer.bind(Object(f.a)(r)),r.pressRotate=r.pressRotate.bind(Object(f.a)(r)),r.changeFocus=r.changeFocus.bind(Object(f.a)(r)),r.changeRotate=r.changeRotate.bind(Object(f.a)(r)),r.changeScale=r.changeScale.bind(Object(f.a)(r)),r.changeShift=r.changeShift.bind(Object(f.a)(r)),r.changeTrasfer=r.changeTrasfer.bind(Object(f.a)(r)),r}return Object(d.a)(t,e),Object(h.a)(t,[{key:"pressDraw",value:function(){this.state.scene.draw()}},{key:"pressSweep",value:function(){this.state.scene.setSweep()}},{key:"pressDefault",value:function(){this.state.scene.setDefault()}},{key:"pressOpenFile",value:function(){var e=this;document.forms.uploadForm.elements.uploadInput.files[0].text().then((function(t){e.state.scene.uploadScene(t)}))}},{key:"pressTransfer",value:function(e,t){var a="add"===t?this.state.transfer[e]:-this.state.transfer[e];this.state.scene.addTransferMatrix(a,e),this.state.scene.draw()}},{key:"pressScale",value:function(e,t){var a="add"===t?this.state.scale[e]:1/this.state.scale[e];this.state.scene.addScaleMatrix(a,e),this.state.scene.draw()}},{key:"pressRotate",value:function(e,t){var a="add"===t?this.state.rotate[e]:-this.state.rotate[e];this.state.scene.addRotateMatrix(a,e),this.state.scene.draw()}},{key:"pressShift",value:function(e,t){var a="add"===t?this.state.shift:-this.state.shift;this.state.scene.addShiftMatix(a),this.state.scene.draw()}},{key:"pressFocus",value:function(e,t){var a="add"===t?this.state.focus:-this.state.focus;this.state.scene.addFocusMatrix(a),this.state.scene.draw()}},{key:"changeTrasfer",value:function(e,t){this.setState(Object(c.a)({},this.state,{transfer:Object(c.a)({},this.state.transfer,Object(o.a)({},e,Number(t)))}))}},{key:"changeScale",value:function(e,t){this.setState(Object(c.a)({},this.state,{scale:Object(c.a)({},this.state.scale,Object(o.a)({},e,Number(t)))}))}},{key:"changeRotate",value:function(e,t){this.setState(Object(c.a)({},this.state,{rotate:Object(c.a)({},this.state.rotate,Object(o.a)({},e,Number(t)))}))}},{key:"changeShift",value:function(e,t){this.setState(Object(c.a)({},this.state,{shift:Number(t)}))}},{key:"changeFocus",value:function(e,t){this.setState(Object(c.a)({},this.state,{focus:Number(t)}))}},{key:"componentDidMount",value:function(){var e=this,t=document.getElementById("canvas"),a=document.getElementById("drawer");t.width=a.clientWidth,t.height=a.clientHeight,this.uploadBtn.current.addEventListener("click",(function(t){e.pressOpenFile(t)})),this.drawBtn.current.addEventListener("click",(function(t){e.pressDraw(t)})),this.sweepBtn.current.addEventListener("click",(function(t){e.pressSweep(t)})),this.defaultBtn.current.addEventListener("click",(function(t){e.pressDefault(t)}))}},{key:"render",value:function(){return n.a.createElement("main",{id:"app"},n.a.createElement("div",{id:"header"},n.a.createElement(T.a,{className:"head-group",raised:!0},n.a.createElement(S.a,{className:"content",style:{padding:"5px"}},n.a.createElement("div",null,n.a.createElement("ui5-button",{ref:this.drawBtn},"\u041e\u0442\u0440\u0438\u0441\u043e\u0432\u0430\u0442\u044c"),n.a.createElement("ui5-button",{ref:this.sweepBtn},"\u0412\u043f\u0438\u0441\u0430\u0442\u044c \u0432 \u044d\u043a\u0440\u0430\u043d"),n.a.createElement("ui5-button",{ref:this.defaultBtn},"\u0418\u0441\u0445\u043e\u0434\u043d\u043e\u0435 \u0441\u043e\u0441\u0442\u043e\u044f\u043d\u0438\u0435"),n.a.createElement("ui5-button",{ref:this.uploadBtn},"\u0417\u0430\u0433\u0440\u0443\u0437\u0438\u0442\u044c \u0441\u0446\u0435\u043d\u0443")),n.a.createElement("form",{id:"uploadForm"},n.a.createElement("input",{id:"uploadInput",type:"file",required:!0}))))),n.a.createElement("div",{id:"drawer"},n.a.createElement("canvas",{id:"canvas",width:"0",height:"0"})),n.a.createElement("div",{id:"functions"},n.a.createElement(T.a,{className:"func-group",raised:!0},n.a.createElement(S.a,{style:{padding:"5px"}},n.a.createElement(O.a,{variant:"overline"},"\u041f\u0435\u0440\u0435\u043d\u043e\u0441"),n.a.createElement(w,{name:m.TX,label:"\u043e\u0441\u044c \u0425",onClick:this.pressTransfer,onChange:this.changeTrasfer}),n.a.createElement(w,{name:m.TY,label:"\u043e\u0441\u044c Y",onClick:this.pressTransfer,onChange:this.changeTrasfer}),n.a.createElement(w,{name:m.TZ,label:"\u043e\u0441\u044c Z",onClick:this.pressTransfer,onChange:this.changeTrasfer}))),n.a.createElement(T.a,{className:"func-group",raised:!0},n.a.createElement(S.a,{style:{padding:"5px"}},n.a.createElement(O.a,{variant:"overline"},"\u041f\u043e\u0432\u043e\u0440\u043e\u0442"),n.a.createElement(w,{name:m.TX,label:"\u043e\u0441\u044c \u0425",onClick:this.pressRotate,onChange:this.changeRotate}),n.a.createElement(w,{name:m.TY,label:"\u043e\u0441\u044c Y",onClick:this.pressRotate,onChange:this.changeRotate}),n.a.createElement(w,{name:m.TZ,label:"\u043e\u0441\u044c Z",onClick:this.pressRotate,onChange:this.changeRotate}))),n.a.createElement(T.a,{className:"func-group",raised:!0},n.a.createElement(S.a,{style:{padding:"5px"}},n.a.createElement(O.a,{variant:"overline"},"\u041c\u0430\u0441\u0448\u0442\u0430\u0431"),n.a.createElement(w,{name:m.TX,label:"\u043e\u0441\u044c \u0425",onClick:this.pressScale,onChange:this.changeScale}),n.a.createElement(w,{name:m.TY,label:"\u043e\u0441\u044c Y",onClick:this.pressScale,onChange:this.changeScale}),n.a.createElement(w,{name:m.TZ,label:"\u043e\u0441\u044c Z",onClick:this.pressScale,onChange:this.changeScale}))),n.a.createElement(T.a,{className:"func-group",raised:!0},n.a.createElement(S.a,{style:{padding:"5px"}},n.a.createElement(O.a,{variant:"overline"},"\u0421\u0434\u0432\u0438\u0433"),n.a.createElement(w,{name:m.TX,label:"\u043e\u0441\u044c \u0425",onClick:this.pressShift,onChange:this.changeShift}))),n.a.createElement(T.a,{className:"func-group",raised:!0},n.a.createElement(S.a,{style:{padding:"5px"}},n.a.createElement(O.a,{variant:"overline"},"\u041e\u041f\u041f"),n.a.createElement(w,{name:m.TX,label:"\u043e\u0441\u044c \u0425",onClick:this.pressFocus,onChange:this.changeFocus})))))}}]),t}(s.Component));Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));i.a.render(n.a.createElement(x,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))}},[[52,1,2]]]);
//# sourceMappingURL=main.22306e73.chunk.js.map